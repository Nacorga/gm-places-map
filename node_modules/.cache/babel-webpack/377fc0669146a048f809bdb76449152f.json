{"ast":null,"code":"import _asyncToGenerator from \"/Users/nacho/Desktop/projects/medium/google-maps/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"./views/places-view/places-view.component\";\nimport * as i3 from \"./views/map-view/map-view.component\";\nimport * as i4 from \"@angular/material/progress-spinner\";\nimport * as i5 from \"./views/input-view/input-view.component\";\n\nfunction AppComponent_ng_container_0_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵelement(2, \"app-places-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵelement(4, \"app-map-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AppComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AppComponent_ng_container_0_div_1_Template, 5, 0, \"div\", 3);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(4);\n\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.scriptLoaded)(\"ngIfElse\", _r3);\n  }\n}\n\nfunction AppComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵelement(1, \"mat-spinner\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AppComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-input-view\", 8);\n    i0.ɵɵlistener(\"submit\", function AppComponent_ng_template_3_Template_app_input_view_submit_0_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.handleApiKey($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport class AppComponent {\n  constructor() {\n    this.loading = true;\n    this.scriptLoaded = false;\n  }\n\n  gm_authFailure() {\n    console.log('XXX');\n  }\n\n  ngOnInit() {\n    this.catchGmAuthFailure();\n    this.checkGmApiKey();\n  }\n\n  handleApiKey(key) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.loading = true;\n      yield _this.loadScript(_this.getScript(key));\n      const oneWeekAfter = new Date(new Date().setDate(new Date().getDate() + 7)).toISOString();\n      localStorage.setItem('gm_api_key', key);\n      localStorage.setItem('gm_api_key_expires_in', oneWeekAfter);\n      _this.scriptLoaded = true;\n      _this.loading = false;\n    })();\n  }\n\n  catchGmAuthFailure() {\n    window.gm_authFailure = () => {\n      this.scriptLoaded = false;\n      localStorage.removeItem('gm_api_key');\n      localStorage.removeItem('gm_api_key_expires_in');\n      alert('Google maps failed to load!');\n    };\n  }\n\n  checkGmApiKey() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (localStorage.getItem('gm_api_key')) {\n        if (new Date(localStorage.getItem('gm_api_key_expires_in')).getTime() < new Date().getTime()) {\n          localStorage.removeItem('gm_api_key');\n          localStorage.removeItem('gm_api_key_expires_in');\n        } else {\n          yield _this2.loadScript(_this2.getScript(localStorage.getItem('gm_api_key')));\n          _this2.scriptLoaded = true;\n        }\n      }\n\n      _this2.loading = false;\n    })();\n  }\n\n  getScript(key) {\n    return `https://maps.googleapis.com/maps/api/js?libraries=places&key=${key}`;\n  }\n\n  loadScript(name) {\n    return new Promise((resolve, reject) => {\n      let script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.src = name;\n      document.getElementsByTagName('head')[0].appendChild(script);\n\n      script.onload = () => {\n        resolve(true);\n      };\n    });\n  }\n\n}\n\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)();\n};\n\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  hostBindings: function AppComponent_HostBindings(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵlistener(\"gm_authFailure\", function AppComponent_gm_authFailure_HostBindingHandler() {\n        return ctx.gm_authFailure();\n      }, false, i0.ɵɵresolveWindow);\n    }\n  },\n  decls: 5,\n  vars: 2,\n  consts: [[4, \"ngIf\", \"ngIfElse\"], [\"loadingTpl\", \"\"], [\"setGmApiKeyTpl\", \"\"], [\"class\", \"app\", 4, \"ngIf\", \"ngIfElse\"], [1, \"app\"], [1, \"app__section\", \"places\"], [1, \"app__section\", \"map\"], [1, \"loading\"], [3, \"submit\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, AppComponent_ng_container_0_Template, 2, 2, \"ng-container\", 0);\n      i0.ɵɵtemplate(1, AppComponent_ng_template_1_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵtemplate(3, AppComponent_ng_template_3_Template, 1, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    }\n\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(2);\n\n      i0.ɵɵproperty(\"ngIf\", !ctx.loading)(\"ngIfElse\", _r1);\n    }\n  },\n  directives: [i1.NgIf, i2.PlacesViewComponent, i3.MapViewComponent, i4.MatSpinner, i5.InputViewComponent],\n  styles: [\".app[_ngcontent-%COMP%] {\\n  height: 100%;\\n  width: 100%;\\n  display: grid;\\n  grid-template-columns: 1fr 3fr;\\n}\\n.app__section.places[_ngcontent-%COMP%] {\\n  height: 100%;\\n  padding: 16px;\\n  background-color: #fff;\\n  border-right: 1px solid #ebebeb;\\n}\\n.loading[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFlBQUE7RUFDQSxXQUFBO0VBQ0EsYUFBQTtFQUNBLDhCQUFBO0FBQ0Y7QUFFSTtFQUNFLFlBQUE7RUFDQSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSwrQkFBQTtBQUFOO0FBS0E7RUFDRSxXQUFBO0VBQ0EsWUFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtFQUNBLHVCQUFBO0FBRkYiLCJmaWxlIjoiYXBwLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmFwcCB7XG4gIGhlaWdodDogMTAwJTtcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDNmcjtcblxuICAmX19zZWN0aW9uIHtcbiAgICAmLnBsYWNlcyB7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICBwYWRkaW5nOiAxNnB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbiAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYigyMzUsIDIzNSwgMjM1KTtcbiAgICB9XG4gIH1cbn1cblxuLmxvYWRpbmcge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbn0iXX0= */\"]\n});","map":{"version":3,"sources":["/Users/nacho/Desktop/projects/medium/google-maps/src/app/app.component.ts"],"names":["i0","i1","i2","i3","i4","i5","AppComponent_ng_container_0_div_1_Template","rf","ctx","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","AppComponent_ng_container_0_Template","ɵɵelementContainerStart","ɵɵtemplate","ɵɵelementContainerEnd","ctx_r0","ɵɵnextContext","_r3","ɵɵreference","ɵɵadvance","ɵɵproperty","scriptLoaded","AppComponent_ng_template_1_Template","AppComponent_ng_template_3_Template","_r7","ɵɵgetCurrentView","ɵɵlistener","AppComponent_ng_template_3_Template_app_input_view_submit_0_listener","$event","ɵɵrestoreView","ctx_r6","handleApiKey","AppComponent","constructor","loading","gm_authFailure","console","log","ngOnInit","catchGmAuthFailure","checkGmApiKey","key","loadScript","getScript","oneWeekAfter","Date","setDate","getDate","toISOString","localStorage","setItem","window","removeItem","alert","getItem","getTime","name","Promise","resolve","reject","script","document","createElement","type","src","getElementsByTagName","appendChild","onload","ɵfac","AppComponent_Factory","t","ɵcmp","ɵɵdefineComponent","selectors","hostBindings","AppComponent_HostBindings","AppComponent_gm_authFailure_HostBindingHandler","ɵɵresolveWindow","decls","vars","consts","template","AppComponent_Template","ɵɵtemplateRefExtractor","_r1","directives","NgIf","PlacesViewComponent","MapViewComponent","MatSpinner","InputViewComponent","styles"],"mappings":"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","sourcesContent":["import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"./views/places-view/places-view.component\";\nimport * as i3 from \"./views/map-view/map-view.component\";\nimport * as i4 from \"@angular/material/progress-spinner\";\nimport * as i5 from \"./views/input-view/input-view.component\";\nfunction AppComponent_ng_container_0_div_1_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵelement(2, \"app-places-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵelement(4, \"app-map-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n} }\nfunction AppComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AppComponent_ng_container_0_div_1_Template, 5, 0, \"div\", 3);\n    i0.ɵɵelementContainerEnd();\n} if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    const _r3 = i0.ɵɵreference(4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.scriptLoaded)(\"ngIfElse\", _r3);\n} }\nfunction AppComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵelement(1, \"mat-spinner\");\n    i0.ɵɵelementEnd();\n} }\nfunction AppComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-input-view\", 8);\n    i0.ɵɵlistener(\"submit\", function AppComponent_ng_template_3_Template_app_input_view_submit_0_listener($event) { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(); return ctx_r6.handleApiKey($event); });\n    i0.ɵɵelementEnd();\n} }\nexport class AppComponent {\n    constructor() {\n        this.loading = true;\n        this.scriptLoaded = false;\n    }\n    gm_authFailure() {\n        console.log('XXX');\n    }\n    ngOnInit() {\n        this.catchGmAuthFailure();\n        this.checkGmApiKey();\n    }\n    async handleApiKey(key) {\n        this.loading = true;\n        await this.loadScript(this.getScript(key));\n        const oneWeekAfter = new Date(new Date().setDate(new Date().getDate() + 7)).toISOString();\n        localStorage.setItem('gm_api_key', key);\n        localStorage.setItem('gm_api_key_expires_in', oneWeekAfter);\n        this.scriptLoaded = true;\n        this.loading = false;\n    }\n    catchGmAuthFailure() {\n        window.gm_authFailure = () => {\n            this.scriptLoaded = false;\n            localStorage.removeItem('gm_api_key');\n            localStorage.removeItem('gm_api_key_expires_in');\n            alert('Google maps failed to load!');\n        };\n    }\n    async checkGmApiKey() {\n        if (localStorage.getItem('gm_api_key')) {\n            if (new Date(localStorage.getItem('gm_api_key_expires_in')).getTime() < new Date().getTime()) {\n                localStorage.removeItem('gm_api_key');\n                localStorage.removeItem('gm_api_key_expires_in');\n            }\n            else {\n                await this.loadScript(this.getScript(localStorage.getItem('gm_api_key')));\n                this.scriptLoaded = true;\n            }\n        }\n        this.loading = false;\n    }\n    getScript(key) {\n        return `https://maps.googleapis.com/maps/api/js?libraries=places&key=${key}`;\n    }\n    loadScript(name) {\n        return new Promise((resolve, reject) => {\n            let script = document.createElement('script');\n            script.type = 'text/javascript';\n            script.src = name;\n            document.getElementsByTagName('head')[0].appendChild(script);\n            script.onload = () => {\n                resolve(true);\n            };\n        });\n    }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) { return new (t || AppComponent)(); };\nAppComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: AppComponent, selectors: [[\"app-root\"]], hostBindings: function AppComponent_HostBindings(rf, ctx) { if (rf & 1) {\n        i0.ɵɵlistener(\"gm_authFailure\", function AppComponent_gm_authFailure_HostBindingHandler() { return ctx.gm_authFailure(); }, false, i0.ɵɵresolveWindow);\n    } }, decls: 5, vars: 2, consts: [[4, \"ngIf\", \"ngIfElse\"], [\"loadingTpl\", \"\"], [\"setGmApiKeyTpl\", \"\"], [\"class\", \"app\", 4, \"ngIf\", \"ngIfElse\"], [1, \"app\"], [1, \"app__section\", \"places\"], [1, \"app__section\", \"map\"], [1, \"loading\"], [3, \"submit\"]], template: function AppComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵtemplate(0, AppComponent_ng_container_0_Template, 2, 2, \"ng-container\", 0);\n        i0.ɵɵtemplate(1, AppComponent_ng_template_1_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(3, AppComponent_ng_template_3_Template, 1, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    } if (rf & 2) {\n        const _r1 = i0.ɵɵreference(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading)(\"ngIfElse\", _r1);\n    } }, directives: [i1.NgIf, i2.PlacesViewComponent, i3.MapViewComponent, i4.MatSpinner, i5.InputViewComponent], styles: [\".app[_ngcontent-%COMP%] {\\n  height: 100%;\\n  width: 100%;\\n  display: grid;\\n  grid-template-columns: 1fr 3fr;\\n}\\n.app__section.places[_ngcontent-%COMP%] {\\n  height: 100%;\\n  padding: 16px;\\n  background-color: #fff;\\n  border-right: 1px solid #ebebeb;\\n}\\n.loading[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFlBQUE7RUFDQSxXQUFBO0VBQ0EsYUFBQTtFQUNBLDhCQUFBO0FBQ0Y7QUFFSTtFQUNFLFlBQUE7RUFDQSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSwrQkFBQTtBQUFOO0FBS0E7RUFDRSxXQUFBO0VBQ0EsWUFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtFQUNBLHVCQUFBO0FBRkYiLCJmaWxlIjoiYXBwLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmFwcCB7XG4gIGhlaWdodDogMTAwJTtcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDNmcjtcblxuICAmX19zZWN0aW9uIHtcbiAgICAmLnBsYWNlcyB7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICBwYWRkaW5nOiAxNnB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbiAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYigyMzUsIDIzNSwgMjM1KTtcbiAgICB9XG4gIH1cbn1cblxuLmxvYWRpbmcge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbn0iXX0= */\"] });\n"]},"metadata":{},"sourceType":"module"}