{"ast":null,"code":"import _asyncToGenerator from \"/Users/nacho/Desktop/projects/medium/google-maps/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { DOCUMENT } from '@angular/common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/snack-bar\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"./views/places-view/places-view.component\";\nimport * as i4 from \"./views/map-view/map-view.component\";\nimport * as i5 from \"@angular/material/progress-spinner\";\nimport * as i6 from \"./views/input-view/input-view.component\";\n\nfunction AppComponent_ng_container_0_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵelement(2, \"app-places-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵelement(4, \"app-map-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AppComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AppComponent_ng_container_0_div_1_Template, 5, 0, \"div\", 3);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(4);\n\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.scriptLoaded)(\"ngIfElse\", _r3);\n  }\n}\n\nfunction AppComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵelement(1, \"mat-spinner\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AppComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-input-view\", 8);\n    i0.ɵɵlistener(\"submit\", function AppComponent_ng_template_3_Template_app_input_view_submit_0_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.handleApiKey($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport class AppComponent {\n  constructor(document, cdr, snackBar) {\n    this.document = document;\n    this.cdr = cdr;\n    this.snackBar = snackBar;\n    this.loading = true;\n    this.scriptLoaded = false;\n    this.window = this.document.defaultView;\n  }\n\n  ngOnInit() {\n    this.catchGmAuthFailure();\n    this.checkGmApiKey();\n  }\n\n  handleApiKey(key) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.loading = true;\n      yield _this.loadScript(_this.getScript(key));\n      const oneWeekAfter = new Date(new Date().setDate(new Date().getDate() + 7)).toISOString();\n      localStorage.setItem('gm_api_key', key);\n      localStorage.setItem('gm_api_key_expires_in', oneWeekAfter);\n      _this.scriptLoaded = true;\n      _this.loading = false;\n\n      _this.cdr.detectChanges();\n    })();\n  }\n\n  catchGmAuthFailure() {\n    this.window.gm_authFailure = () => {\n      this.scriptLoaded = false;\n      localStorage.removeItem('gm_api_key');\n      localStorage.removeItem('gm_api_key_expires_in');\n      this.openSnackBar();\n      this.cdr.detectChanges();\n    };\n  }\n\n  checkGmApiKey() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (localStorage.getItem('gm_api_key')) {\n        if (new Date(localStorage.getItem('gm_api_key_expires_in')).getTime() < new Date().getTime()) {\n          localStorage.removeItem('gm_api_key');\n          localStorage.removeItem('gm_api_key_expires_in');\n        } else {\n          yield _this2.loadScript(_this2.getScript(localStorage.getItem('gm_api_key')));\n          _this2.scriptLoaded = true;\n        }\n      }\n\n      _this2.loading = false;\n\n      _this2.cdr.detectChanges();\n    })();\n  }\n\n  getScript(key) {\n    return `https://maps.googleapis.com/maps/api/js?libraries=places&key=${key}`;\n  }\n\n  loadScript(name) {\n    return new Promise((resolve, reject) => {\n      let script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.src = name;\n      document.getElementsByTagName('head')[0].appendChild(script);\n\n      script.onload = () => {\n        resolve(true);\n      };\n    });\n  }\n\n  openSnackBar() {\n    this.snackBar.open('Google maps failed to load!', undefined, {\n      duration: 5000,\n      horizontalPosition: 'center',\n      verticalPosition: 'bottom'\n    });\n  }\n\n}\n\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(DOCUMENT), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.MatSnackBar));\n};\n\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  decls: 5,\n  vars: 2,\n  consts: [[4, \"ngIf\", \"ngIfElse\"], [\"loadingTpl\", \"\"], [\"setGmApiKeyTpl\", \"\"], [\"class\", \"app\", 4, \"ngIf\", \"ngIfElse\"], [1, \"app\"], [1, \"app__section\", \"places\"], [1, \"app__section\", \"map\"], [1, \"loading\"], [3, \"submit\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, AppComponent_ng_container_0_Template, 2, 2, \"ng-container\", 0);\n      i0.ɵɵtemplate(1, AppComponent_ng_template_1_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵtemplate(3, AppComponent_ng_template_3_Template, 1, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    }\n\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(2);\n\n      i0.ɵɵproperty(\"ngIf\", !ctx.loading)(\"ngIfElse\", _r1);\n    }\n  },\n  directives: [i2.NgIf, i3.PlacesViewComponent, i4.MapViewComponent, i5.MatSpinner, i6.InputViewComponent],\n  styles: [\".app[_ngcontent-%COMP%] {\\n  height: 100%;\\n  width: 100%;\\n  display: grid;\\n  grid-template-columns: 1fr 3fr;\\n}\\n.app__section.places[_ngcontent-%COMP%] {\\n  height: 100%;\\n  padding: 16px;\\n  background-color: #fff;\\n  border-right: 1px solid #ebebeb;\\n}\\n.loading[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFlBQUE7RUFDQSxXQUFBO0VBQ0EsYUFBQTtFQUNBLDhCQUFBO0FBQ0Y7QUFFSTtFQUNFLFlBQUE7RUFDQSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSwrQkFBQTtBQUFOO0FBS0E7RUFDRSxXQUFBO0VBQ0EsWUFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtFQUNBLHVCQUFBO0FBRkYiLCJmaWxlIjoiYXBwLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmFwcCB7XG4gIGhlaWdodDogMTAwJTtcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDNmcjtcblxuICAmX19zZWN0aW9uIHtcbiAgICAmLnBsYWNlcyB7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICBwYWRkaW5nOiAxNnB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbiAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYigyMzUsIDIzNSwgMjM1KTtcbiAgICB9XG4gIH1cbn1cblxuLmxvYWRpbmcge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbn0iXX0= */\"],\n  changeDetection: 0\n});","map":{"version":3,"sources":["/Users/nacho/Desktop/projects/medium/google-maps/src/app/app.component.ts"],"names":["DOCUMENT","i0","i1","i2","i3","i4","i5","i6","AppComponent_ng_container_0_div_1_Template","rf","ctx","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","AppComponent_ng_container_0_Template","ɵɵelementContainerStart","ɵɵtemplate","ɵɵelementContainerEnd","ctx_r0","ɵɵnextContext","_r3","ɵɵreference","ɵɵadvance","ɵɵproperty","scriptLoaded","AppComponent_ng_template_1_Template","AppComponent_ng_template_3_Template","_r7","ɵɵgetCurrentView","ɵɵlistener","AppComponent_ng_template_3_Template_app_input_view_submit_0_listener","$event","ɵɵrestoreView","ctx_r6","handleApiKey","AppComponent","constructor","document","cdr","snackBar","loading","window","defaultView","ngOnInit","catchGmAuthFailure","checkGmApiKey","key","loadScript","getScript","oneWeekAfter","Date","setDate","getDate","toISOString","localStorage","setItem","detectChanges","gm_authFailure","removeItem","openSnackBar","getItem","getTime","name","Promise","resolve","reject","script","createElement","type","src","getElementsByTagName","appendChild","onload","open","undefined","duration","horizontalPosition","verticalPosition","ɵfac","AppComponent_Factory","t","ɵɵdirectiveInject","ChangeDetectorRef","MatSnackBar","ɵcmp","ɵɵdefineComponent","selectors","decls","vars","consts","template","AppComponent_Template","ɵɵtemplateRefExtractor","_r1","directives","NgIf","PlacesViewComponent","MapViewComponent","MatSpinner","InputViewComponent","styles","changeDetection"],"mappings":"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","sourcesContent":["import { DOCUMENT } from '@angular/common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/snack-bar\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"./views/places-view/places-view.component\";\nimport * as i4 from \"./views/map-view/map-view.component\";\nimport * as i5 from \"@angular/material/progress-spinner\";\nimport * as i6 from \"./views/input-view/input-view.component\";\nfunction AppComponent_ng_container_0_div_1_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵelement(2, \"app-places-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵelement(4, \"app-map-view\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n} }\nfunction AppComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AppComponent_ng_container_0_div_1_Template, 5, 0, \"div\", 3);\n    i0.ɵɵelementContainerEnd();\n} if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    const _r3 = i0.ɵɵreference(4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.scriptLoaded)(\"ngIfElse\", _r3);\n} }\nfunction AppComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵelement(1, \"mat-spinner\");\n    i0.ɵɵelementEnd();\n} }\nfunction AppComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-input-view\", 8);\n    i0.ɵɵlistener(\"submit\", function AppComponent_ng_template_3_Template_app_input_view_submit_0_listener($event) { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(); return ctx_r6.handleApiKey($event); });\n    i0.ɵɵelementEnd();\n} }\nexport class AppComponent {\n    constructor(document, cdr, snackBar) {\n        this.document = document;\n        this.cdr = cdr;\n        this.snackBar = snackBar;\n        this.loading = true;\n        this.scriptLoaded = false;\n        this.window = this.document.defaultView;\n    }\n    ngOnInit() {\n        this.catchGmAuthFailure();\n        this.checkGmApiKey();\n    }\n    async handleApiKey(key) {\n        this.loading = true;\n        await this.loadScript(this.getScript(key));\n        const oneWeekAfter = new Date(new Date().setDate(new Date().getDate() + 7)).toISOString();\n        localStorage.setItem('gm_api_key', key);\n        localStorage.setItem('gm_api_key_expires_in', oneWeekAfter);\n        this.scriptLoaded = true;\n        this.loading = false;\n        this.cdr.detectChanges();\n    }\n    catchGmAuthFailure() {\n        this.window.gm_authFailure = () => {\n            this.scriptLoaded = false;\n            localStorage.removeItem('gm_api_key');\n            localStorage.removeItem('gm_api_key_expires_in');\n            this.openSnackBar();\n            this.cdr.detectChanges();\n        };\n    }\n    async checkGmApiKey() {\n        if (localStorage.getItem('gm_api_key')) {\n            if (new Date(localStorage.getItem('gm_api_key_expires_in')).getTime() < new Date().getTime()) {\n                localStorage.removeItem('gm_api_key');\n                localStorage.removeItem('gm_api_key_expires_in');\n            }\n            else {\n                await this.loadScript(this.getScript(localStorage.getItem('gm_api_key')));\n                this.scriptLoaded = true;\n            }\n        }\n        this.loading = false;\n        this.cdr.detectChanges();\n    }\n    getScript(key) {\n        return `https://maps.googleapis.com/maps/api/js?libraries=places&key=${key}`;\n    }\n    loadScript(name) {\n        return new Promise((resolve, reject) => {\n            let script = document.createElement('script');\n            script.type = 'text/javascript';\n            script.src = name;\n            document.getElementsByTagName('head')[0].appendChild(script);\n            script.onload = () => {\n                resolve(true);\n            };\n        });\n    }\n    openSnackBar() {\n        this.snackBar.open('Google maps failed to load!', undefined, { duration: 5000, horizontalPosition: 'center', verticalPosition: 'bottom' });\n    }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) { return new (t || AppComponent)(i0.ɵɵdirectiveInject(DOCUMENT), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.MatSnackBar)); };\nAppComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: AppComponent, selectors: [[\"app-root\"]], decls: 5, vars: 2, consts: [[4, \"ngIf\", \"ngIfElse\"], [\"loadingTpl\", \"\"], [\"setGmApiKeyTpl\", \"\"], [\"class\", \"app\", 4, \"ngIf\", \"ngIfElse\"], [1, \"app\"], [1, \"app__section\", \"places\"], [1, \"app__section\", \"map\"], [1, \"loading\"], [3, \"submit\"]], template: function AppComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵtemplate(0, AppComponent_ng_container_0_Template, 2, 2, \"ng-container\", 0);\n        i0.ɵɵtemplate(1, AppComponent_ng_template_1_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(3, AppComponent_ng_template_3_Template, 1, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    } if (rf & 2) {\n        const _r1 = i0.ɵɵreference(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading)(\"ngIfElse\", _r1);\n    } }, directives: [i2.NgIf, i3.PlacesViewComponent, i4.MapViewComponent, i5.MatSpinner, i6.InputViewComponent], styles: [\".app[_ngcontent-%COMP%] {\\n  height: 100%;\\n  width: 100%;\\n  display: grid;\\n  grid-template-columns: 1fr 3fr;\\n}\\n.app__section.places[_ngcontent-%COMP%] {\\n  height: 100%;\\n  padding: 16px;\\n  background-color: #fff;\\n  border-right: 1px solid #ebebeb;\\n}\\n.loading[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFlBQUE7RUFDQSxXQUFBO0VBQ0EsYUFBQTtFQUNBLDhCQUFBO0FBQ0Y7QUFFSTtFQUNFLFlBQUE7RUFDQSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSwrQkFBQTtBQUFOO0FBS0E7RUFDRSxXQUFBO0VBQ0EsWUFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtFQUNBLHVCQUFBO0FBRkYiLCJmaWxlIjoiYXBwLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmFwcCB7XG4gIGhlaWdodDogMTAwJTtcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDNmcjtcblxuICAmX19zZWN0aW9uIHtcbiAgICAmLnBsYWNlcyB7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICBwYWRkaW5nOiAxNnB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbiAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYigyMzUsIDIzNSwgMjM1KTtcbiAgICB9XG4gIH1cbn1cblxuLmxvYWRpbmcge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbn0iXX0= */\"], changeDetection: 0 });\n"]},"metadata":{},"sourceType":"module"}